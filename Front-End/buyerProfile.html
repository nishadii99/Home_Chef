<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Home Chef-Buyer Profile</title>
    <link href="plugins/slick-carousel/slick/slick.css" rel="stylesheet">
    <link href="plugins/slick-carousel/slick/slick-theme.css" rel="stylesheet">

    <!-- Slick Slider JS -->
    <script src="plugins/slick-carousel/slick/slick.min.js"></script>
    <!-- Bootstrap -->
    <link href="plugins/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- Owl Carousel -->
    <link href="plugins/slick-carousel/slick/slick.css" rel="stylesheet">
    <link href="plugins/slick-carousel/slick/slick-theme.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link href="plugins/fancybox/jquery.fancybox.pack.css" rel="stylesheet">
    <link href="plugins/jquery-nice-select/css/nice-select.css" rel="stylesheet">
    <link href="plugins/seiyria-bootstrap-slider/dist/css/bootstrap-slider.min.css" rel="stylesheet">
    <!-- CUSTOM CSS -->
    <link href="css/style.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/logo2-removebg-preview.png" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap"
        rel="stylesheet" />

    <link rel="stylesheet" href="fonts/icomoon/style.css" />
    <link rel="stylesheet" href="fonts/flaticon/font/flaticon.css" />

    <link rel="stylesheet" href="css/tiny-slider.css" />
    <link rel="stylesheet" href="css/aos.css" />
    <link rel="stylesheet" href="css/style1.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/shoppingCart.css" />
</head>

<body class="body-wrapper">
    <section id="navbar">
        <div class="container" style="">
            <div class="row">
                <div class="col-md-12">
                    <nav class="navbar navbar-expand-lg  navigation">
                        <a class="navbar-brand" href="pages/index.html">
                            <img style="width: 3rem;height: 3rem" src="img/logo2-removebg-preview.png" alt="">
                            <span>Home Chef</span></a>
                        </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="navbar-toggler-icon"></span>
                        </button>
                        <div class="collapse navbar-collapse" id="navbarSupportedContent">
                            <ul class="navbar-nav ml-auto main-nav ">
                                <li class="nav-item active">
                                    <a class="nav-link" href="buyerHome.html">Home</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="buyerDashboard.html">Dashboard</a>
                                </li>
                                <li class="nav-item dropdown dropdown-slide">
                                    <a class="nav-link dropdown-toggle" href="#" data-toggle="dropdown"
                                        aria-haspopup="true" aria-expanded="false">
                                        Pages <span><i class="fa fa-angle-down"></i></span>
                                    </a>
                                    <!-- Dropdown list -->
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="blog.html">Blog</a>
                                        <a class="dropdown-item" href="s-comment.html">Leave Some Comments</a>
                                    </div>
                                </li>
                                <li class="nav-item dropdown dropdown-slide">
                                    <a class="nav-link dropdown-toggle" href="" data-toggle="dropdown"
                                        aria-haspopup="true" aria-expanded="false">
                                        Others <span><i class="fa fa-angle-down"></i></span>
                                    </a>
                                    <!-- Dropdown list -->
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <a class="dropdown-item" href="#">Chatting</a>
                                        <!--									<a class="dropdown-item" href="#">Another action</a>-->
                                        <!--									<a class="dropdown-item" href="#">Something else here</a>-->
                                    </div>
                                </li>
                            </ul>
                            <ul class="navbar-nav ml-auto mt-10">
                                <li class="nav-item">
                                    <a class="nav-link login-button" style="border-radius: 20px"
                                        href="buyerProfile.html">Profile</a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link add-button" style="border-radius: 20px" href="index-1.html"><i
                                            class="fa fa-sign-out-alt me-2"></i>Logout</a>
                                </li>
                                <li class="nav-item dropdown dropdown-slide">
                                    <a class="nav-link dropdown-toggle cart-button" href="#" data-toggle="dropdown"
                                        aria-haspopup="true" aria-expanded="false" style="position: relative;">
                                        <i class="fas fa-shopping-cart"></i>
                                        <span class="cart-count-badge">3</span>
                                    </a>
                                    <!-- Cart Dropdown Preview -->
                                    <div class="dropdown-menu dropdown-menu-right dropdown-cart"
                                        style="min-width: 300px; padding: 15px;">
                                        <h6 class="dropdown-header">Your Cart (3 items)</h6>
                                        <div class="dropdown-divider"></div>

                                        <!-- Cart Items Preview -->
                                        <div class="cart-preview-item">
                                            <img src="https://via.placeholder.com/50" alt="Product"
                                                class="cart-item-image">
                                            <div class="cart-item-details">
                                                <p class="mb-1">Product Name</p>
                                                <small>1 x $19.99</small>
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger cart-item-remove">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>

                                        <div class="cart-preview-item">
                                            <img src="https://via.placeholder.com/50" alt="Product"
                                                class="cart-item-image">
                                            <div class="cart-item-details">
                                                <p class="mb-1">Another Product</p>
                                                <small>2 x $29.99</small>
                                            </div>
                                            <button class="btn btn-sm btn-outline-danger cart-item-remove">
                                                <i class="fas fa-times"></i>
                                            </button>
                                        </div>

                                        <div class="dropdown-divider"></div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <strong>Subtotal:</strong>
                                            <span>$79.97</span>
                                        </div>
                                        <a href="shoppingCart.html" class="btn btn-primary btn-block">View Cart</a>
                                        <a href="payment.html" class="btn btn-success btn-block mt-2">Checkout</a>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
    </section>



    <!--==================================
=            User Profile            =
===================================-->

    <section class="user-profile section" style="margin-top: 100px">
        <div class="container">
            <div class="row">
                <div class="col-md-10 offset-md-1 col-lg-4 offset-lg-0">
                    <div class="sidebar">
                        <!-- User Widget -->
                        <div class="widget user-dashboard-profile">
                            <!-- User Image -->
                            <div class="profile-thumb">
                                <img src="img/default-profile.jpeg" alt="" class="rounded-circle" id="image">
                            </div>
                            <!-- User Name -->
                            <h5 class="text-center" id="name"></h5>
                            <!--                        <p id="data">Joined February 06, 2017</p>-->
                        </div>
                        <!-- Dashboard Links -->
                        <div class="widget user-dashboard-menu">
                            <ul>
                                <li>
                                    <a href="dashboardAdds.html"><i class="fa fa-user"></i> My Ads</a>
                                </li>
                                <!--                            <li>-->
                                <!--                                <a href="dashboard-favourite-ads.html"><i class="fa fa-bookmark-o"></i> Favourite Ads <span>5</span></a>-->
                                <!--                            </li>-->
                                <!--                            <li>-->
                                <!--                                <a href="dashboard-archived-ads.html"><i class="fa fa-file-archive-o"></i>Archeved Ads <span>12</span></a>-->
                                <!--                            </li>-->
                                <!--                            <li>-->
                                <!--                                <a href="dashboard-pending-ads.html"><i class="fa fa-bolt"></i> Pending Approval<span>23</span></a>-->
                                <!--                            </li>-->
                                <li>
                                    <a href="index-1.html"><i class="fa fa-cog"></i> Logout</a>
                                </li>
                                <li>
                                    <a href="delete-account.html"><i class="fa fa-power-off"></i>Delete Account</a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-0">
                    <!-- Edit Personal Info -->
                    <div class="widget personal-info">
                        <h3 class="widget-header user">Edit Personal Information</h3>
                        <form action="#">
                            <!-- First Name -->
                            <div class="form-group">
                                <label for="first-name">First Name</label>
                                <input type="text" class="form-control" id="first-name">
                            </div>
                            <!-- Last Name -->
                            <div class="form-group">
                                <label for="last-name">Last Name</label>
                                <input type="text" class="form-control" id="last-name">
                            </div>
                            <div class="form-group">
                                <label for="last-name">Email</label>
                                <input type="email" class="form-control" id="email">
                            </div>
                            <!-- File chooser -->
                            <div class="form-group choose-file">
                                <i class="fa fa-user text-center"></i>
                                <input type="file" class="form-control-file d-inline" id="input-file">
                            </div>
                            <!-- Comunity Name -->
                            <div class="form-group">
                                <label for="address"> Address</label>
                                <input type="text" class="form-control" id="address">
                            </div>
                            <div class="form-group">
                                <label for="contact"> Contact Number</label>
                                <input type="text" class="form-control" id="contact">
                            </div>
                            <!-- Submit button -->
                            <button class="btn btn-transparent">Save My Changes</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!--============================
=            Footer            =
=============================-->
    <footer class="footer section section-sm"
        style="background-color:#003838; color:white; padding-top:60px; padding-bottom:60px;">
        <div class="container" style="background-color:#003838;">
            <div class="row">
                <!-- About -->
                <div class="col-lg-3 col-md-7 offset-md-1 offset-lg-0 text-center text-lg-start">
                    <div class="block about">
                        <img src="img/logo2-removebg-preview.png" alt="Home Chef Logo" style="width:180px; height:auto;"
                            class="mb-3">
                        <p>
                            Home Chef is your go-to platform for fresh meal kits, ready-to-eat dishes, and gourmet home
                            cooking. Connect with professional chefs and enjoy homemade-quality meals today!
                        </p>
                    </div>
                </div>

                <!-- Site Pages -->
                <div class="col-lg-2 offset-lg-1 col-md-3 mt-4 mt-lg-0">
                    <div class="block">
                        <h4 style="color:white;">Site Pages</h4>
                        <ul class="list-unstyled">
                            <li><a href="#" style="color:white;">Home</a></li>
                            <li><a href="#" style="color:white;">Menu</a></li>
                            <li><a href="#" style="color:white;">How It Works</a></li>
                            <li><a href="#" style="color:white;">Deals & Coupons</a></li>
                            <li><a href="#" style="color:white;">Articles & Tips</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Admin Pages -->
                <div class="col-lg-2 col-md-3 offset-md-1 offset-lg-0 mt-4 mt-lg-0">
                    <div class="block">
                        <h4 style="color:white;">Admin Pages</h4>
                        <ul class="list-unstyled">
                            <li><a href="#" style="color:white;">Dashboard</a></li>
                            <li><a href="#" style="color:white;">Manage Orders</a></li>
                            <li><a href="#" style="color:white;">Manage Chefs</a></li>
                            <li><a href="#" style="color:white;">Reports</a></li>
                            <li><a href="#" style="color:white;">Settings</a></li>
                        </ul>
                    </div>
                </div>

                <!-- App Promotion -->
                <div class="col-lg-4 col-md-7 mt-4 mt-lg-0 text-center text-lg-start">
                    <div class="block-2 app-promotion">
                        <a href="#">
                            <img src="images/footer/phone-icon.png" alt="mobile-icon" style="width:60px; height:auto;">
                        </a>
                        <p class="mt-2">
                            Get the Home Chef Mobile App and order your favorite meals anywhere, anytime!
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Footer Bottom -->
    <footer class="footer-bottom" style="background-color:#002f2f; color:white; padding:15px 0;">
        <div class="container" style="background-color:#002f2f;">
            <div class="row align-items-center">
                <div class="col-sm-6 col-12 text-center text-sm-start">
                    <p class="mb-0">Copyright © 2025 Home Chef. All Rights Reserved.</p>
                </div>
                <div class="col-sm-6 col-12 text-center text-sm-end">
                    <!-- Social Icons -->
                    <ul class="list-inline mb-0">
                        <li class="list-inline-item"><a href="#" class="text-white fs-5 me-2"><i
                                    class="fab fa-facebook-f"></i></a></li>
                        <li class="list-inline-item"><a href="#" class="text-white fs-5 me-2"><i
                                    class="fab fa-twitter"></i></a></li>
                        <li class="list-inline-item"><a href="#" class="text-white fs-5 me-2"><i
                                    class="fab fa-instagram"></i></a></li>
                        <li class="list-inline-item"><a href="#" class="text-white fs-5"><i
                                    class="fab fa-linkedin-in"></i></a></li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- To Top -->
        <div class="top-to text-center mt-2">
            <a id="top" href="#" class="text-white fs-4"><i class="fas fa-angle-up"></i></a>
        </div>
    </footer>

    <!-- JAVASCRIPTS -->

    <script src="frameWork/jquery/jquery-3.7.1.min.js"></script>
    <script src="plugins/jquery/jquery.min.js"></script>
    <script src="plugins/jquery-ui/jquery-ui.min.js"></script>
    <script src="plugins/tether/js/tether.min.js"></script>
    <script src="plugins/raty/jquery.raty-fa.js"></script>
    <script src="plugins/bootstrap/dist/js/popper.min.js"></script>
    <script src="plugins/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="plugins/seiyria-bootstrap-slider/dist/bootstrap-slider.min.js"></script>
    <script src="plugins/slick-carousel/slick/slick.min.js"></script>
    <script src="plugins/jquery-nice-select/js/jquery.nice-select.min.js"></script>
    <script src="plugins/fancybox/jquery.fancybox.pack.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCC72vZw-6tGqFyRhhg5CkF2fqfILn2Tsw"></script>
    <script src="js/scripts.js"></script>
    <script src="frameWork/sweetalert2/sweetalert2.all.min.js"></script>
    <script src="js/profile.js"></script>
    <script>
        $(document).ready(function () {
            const token = localStorage.getItem('token');

            if (!token) {
                console.error("Token not found!");
                return;
            }

            // Decode JWT and extract email
            function getEmailFromToken(token) {
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    return payload.sub || payload.email || "";
                } catch (error) {
                    console.error("Error decoding token:", error);
                    return "";
                }
            }

            const email = getEmailFromToken(token);
            console.log("Extracted email:", email);
            $("#email").val(email);

            // ---------------- Load User Data ----------------
            $.ajax({
                url: `http://localhost:8080/api/v1/profile/me`,
                method: 'GET',
                headers: {
                    'Authorization': 'Bearer ' + token
                },
                success: function (user) {
                    console.log("User Data:", user.data.firstName);

                    // Set profile fields
                    if (user.data) {
                        $("#first-name").val(user.data.firstName || "");
                        $("#last-name").val(user.data.lastName || "");
                    }
                    $("#address").val(user.data.address || "");
                    $("#contact").val(user.data.contact || "");
                    $("#email").val(user.data.email || email);

                    // Set profile image
                    if (user.data.image) {
                        $("#image").attr("src", user.data.image);
                    }
                },
                error: function (xhr) {
                    console.error("Error fetching user data:", xhr.responseText);
                }
            });

            // ---------------- Update Profile ----------------
            $("form").on("submit", function (e) {
                e.preventDefault();

                let firstName = $("#first-name").val();
                let lastName = $("#last-name").val();
                let address = $("#address").val();
                let contact = $("#contact").val();
                let file = $("#input-file")[0].files[0];

                let formData = new FormData();
                formData.append("firstName", firstName);
                formData.append("lastName", lastName);
                formData.append("address", address);
                formData.append("contact", contact);
                if (file) formData.append("image", file);

                $.ajax({
                    url: `http://localhost:8080/api/v1/profile/updateProfile`,
                    method: 'PUT', // or PUT if your backend supports it
                    data: formData,
                    processData: false,
                    contentType: false,
                    headers: {
                        'Authorization': 'Bearer ' + token
                    },
                    success: function (response) {
                        console.log("Profile updated:", response);

                        $("#image").attr("src", response.data.image);
                        console.log("Updated image URL:", response.data.image);
                        Swal.fire('Success', 'Profile updated successfully', 'success');
                    },
                    error: function (xhr) {
                        console.error("Update failed:", xhr.responseText);
                        Swal.fire('Error', 'Profile update failed', 'error');
                    }
                });
            });
        });


    </script>


</body>

</html>